name: Deploy NodeJs application to Render

on:
    push:
        branches:
            - main
jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Code
              uses: actions/checkout@v4

            # Step 2: Set up Node.js
            - name: set up NodeJs
              uses: actions/setup-node@v3
              with:
                node-version: '22'

            # Step 3: Install dependencies
            - name: Install dependencies
              run: npm install
            
            - name: Build app (if needed)
              run: npm run build || echo "No build step defined"
              
            # Step 5: Deploy to Render
            - name: Deploy to Render
              env:
                 RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
                 RENDER_SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
              run: |
                echo "Triggering deployment on Render..."
                curl -X POST https://api.render.com/deploy/srv-${RENDER_SERVICE_ID} \
                    -H "Authorization: Bearer $RENDER_API_KEY" \
                    -H "Accept: application/json" \
                    -H "Content-Type: application/json" \
                    -d '{}'